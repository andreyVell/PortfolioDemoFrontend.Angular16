<app-client-navigation-header [isSarchFieldVisible]='false'>
    <div class="workblock-background">
        <div class="row m-0 p-0 d-flex justify-content-center">
            <div class="col-xxl-9 col-xl-10 col-lg-11 col-md-12 col-sm-12 col-12 m-0 p-0">
                <div class="row details-page-title-container justify-content-between">
                    <div class="col-auto m-0 p-0 d-flex align-items-center" style="max-height: 48px;">
                        <button [matTooltip]="'Назад к проекту ' + projectName" mat-icon-button color="primary" (click)="BackPageClick()">
                            <mat-icon>arrow_back</mat-icon>
                        </button>
                        <span style="font-size: 24px; font-weight: 500;">
                            Информация об этапе:
                        </span>
                    </div>
                </div>
                <div *ngIf="!IsSmallScreen(); else smallScreenTemplate"
                    class="row client-details-page-main-content-container"
                    style="padding: 0px; background: transparent;">
                    <div class="col m-0 p-0">
                        <div class="half-height-container">
                            <div class="card-container-mright">
                                <div class="row m-0 p-0" style="min-width: 48px!important;">
                                    <div class="col p-0 m-0">
                                        <div class="row p-0 m-0">
                                            <div
                                                class="col-auto p-0 m-0 d-flex justify-content-center align-items-center">
                                                <button class="info-button" [matTooltip]="projectStage.name">
                                                    <mat-icon>info_outline</mat-icon>
                                                </button>
                                            </div>
                                            <div class="col-11">
                                                <span class="project-stage-name-title">
                                                    {{projectStageHeader}}
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <mat-divider class="mt-3"></mat-divider>
                                <div class="half-height-content-container">
                                    <div class="row mt-2 m-0 p-0">
                                        <div class="col-auto mt-2">
                                            <div style="width: 120px;">
                                                <span class="p-0" style="font-size: 18px; margin-top: 10px!important;">
                                                    Завершён:
                                                </span>
                                            </div>
                                        </div>
                                        <div class="col">
                                            <span class="p-0" style="font-size: 18px">
                                                <mat-chip-listbox>
                                                    <div class="w-100 d-flex justify-content-start m-0">
                                                        <mat-chip
                                                            [class.mat-chip-main-color-style]="projectStage.isCompleted">
                                                            <span
                                                                [class.mat-chip-main-color-font-style]="projectStage.isCompleted"
                                                                style="font-size: 16px;">Да</span>
                                                        </mat-chip>
                                                        <mat-chip
                                                            [class.mat-chip-main-color-style]="!projectStage.isCompleted">
                                                            <span
                                                                [class.mat-chip-main-color-font-style]="!projectStage.isCompleted"
                                                                style="font-size: 16px;">Нет</span></mat-chip>
                                                    </div>
                                                </mat-chip-listbox>
                                            </span>
                                        </div>
                                    </div>
                                    <div class="row mt-1 m-0 p-0">
                                        <div class="col-auto mt-2">
                                            <div style="width: 120px;">
                                                <span class="p-0" style="font-size: 18px; margin-top: 10px!important;">
                                                    Название:
                                                </span>
                                            </div>
                                        </div>
                                        <div class="col">
                                            <span class="p-0" style="font-size: 18px">
                                                <mat-form-field appearance="outline" class="w-100"
                                                    style="max-width: 650px;">
                                                    <textarea readonly="true" matInput type="text"
                                                        [(ngModel)]="projectStage.name" rows="3" #textAreaName
                                                        maxlength="5000"></textarea>
                                                    <mat-hint align="end">
                                                        {{textAreaName.value.length}}/1000
                                                    </mat-hint>
                                                </mat-form-field>
                                            </span>
                                        </div>
                                    </div>
                                    <div class="row m-0 p-0">
                                        <div class="col-auto mt-2">
                                            <div style="width: 120px;">
                                                <span class="p-0" style="font-size: 18px; margin-top: 10px!important;">
                                                    Описание:
                                                </span>
                                            </div>
                                        </div>
                                        <div class="col">
                                            <span class="p-0" style="font-size: 18px">
                                                <mat-form-field appearance="outline" class="w-100"
                                                    style="max-width: 650px;">
                                                    <textarea readonly="true" matInput type="text"
                                                        [(ngModel)]="projectStage.description" rows="5"
                                                        #textAreaDescription maxlength="5000"></textarea>
                                                    <mat-hint align="end">
                                                        {{textAreaDescription.value.length}}/5000
                                                    </mat-hint>
                                                </mat-form-field>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row m-0 p-0 half-height-container">
                            <div class="col m-0 p-0 card-container-mright" style="min-width: 200px;">
                                <div class="row m-0 p-0">
                                    <div class="col-auto d-flex align-items-center"
                                        style="font-size: 20px;min-height: 48px;">
                                        <span class="p-0">
                                            Ответственные лица ({{projectStage.stageManagers.length}}):
                                        </span>
                                    </div>
                                </div>
                                <mat-divider></mat-divider>
                                <div class="half-height-content-container">
                                    <div class="row m-0 p-0" *ngFor="let stageManager of projectStage.stageManagers">
                                        <div class="col-auto">
                                            <button mat-icon-button color="primary">
                                                <mat-icon>person</mat-icon>
                                            </button>
                                        </div>
                                        <div class="col-auto m-0 p-0"
                                            style="display: flex; justify-content: center; flex-direction: column;">
                                            <div class="row m-0 p-0">
                                                <span style="font-size: 18px; line-height: 20px" class="p-0">
                                                    {{stageManager.employee?.GetFullName()}}
                                                </span>
                                            </div>
                                            <div class="row m-0 p-0">
                                                <span class="p-0" style="font-size: 14px; color: gray;">
                                                    {{(stageManager.employee?.lastJob?.positionName ?? "") +
                                                    ((!!stageManager.employee?.lastJob?.positionName &&
                                                    !!stageManager.employee?.lastJob?.divisionName) ? ' - ' : "") +
                                                    (stageManager.employee?.lastJob?.divisionName ?? "")}}
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col m-0 p-0  card-container" style="min-width: 200px;">
                                <div class="row m-0 p-0">
                                    <div class="col-auto d-flex align-items-center"
                                        style="font-size: 20px; min-height: 48px;">
                                        <span class="p-0">
                                            Исполнители ({{projectStage.contractors.length}}):
                                        </span>
                                    </div>
                                </div>
                                <mat-divider></mat-divider>
                                <div class="half-height-content-container">
                                    <div class="row m-0 p-0" *ngFor="let contractor of projectStage.contractors">
                                        <div class="col-auto">
                                            <button mat-icon-button color="primary">
                                                <mat-icon>home_work</mat-icon>
                                            </button>
                                        </div>
                                        <div class="col-auto m-0 p-0 d-flex align-items-center">
                                            <span class="p-0" style="font-size: 18px">
                                                {{contractor.division?.name}}
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-auto m-0 p-0">
                        <div class="full-height-container">
                            <div class="card-container-mleft" style="min-width: 300px;">
                                <div class="row m-0 p-0">
                                    <div class="col-auto d-flex align-items-center"
                                        style="font-size: 20px; min-height: 48px;">
                                        <span class="p-0">
                                            Отчёты ({{projectStage.stageReports.length}}):
                                        </span>
                                    </div>
                                </div>
                                <mat-divider></mat-divider>
                                <div class="full-height-content-container" style="padding-top: 8px;">
                                    <div class="row m-0 p-0" *ngFor="let report of projectStage.stageReports">
                                        <div class="col-auto">
                                            <div class="row m-0 p-0">
                                                <span style="font-size: 18px; line-height: 20px" class="p-0 link-button"
                                                    (click)="OpenStageReportDetails(report)">
                                                    {{report.name}}
                                                </span>
                                            </div>
                                            <div class="row m-0 p-0">
                                                <div class="col-auto m-0 p-0">
                                                    <span class="p-0" style="font-size: 16px; font-style: italic;">
                                                        {{report.stageManager?.employee?.GetLastNameAndInitials()}}
                                                    </span>
                                                </div>
                                                <div class="col-auto">
                                                    <span class="p-0" style="font-size: 16px; font-style: italic;">
                                                        Файлы: ({{report.attachedFiles.length}})
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <ng-template #smallScreenTemplate>
                    <div class="row small-details-page-main-content-container"
                        style="padding: 0px; background: transparent;">
                        <div class="col p-0 m-0">
                            <div class="card-container">
                                <div class="row m-0 p-0" style="min-width: 48px!important;">
                                    <div class="col p-0 m-0">
                                        <div class="row p-0 m-0">
                                            <div
                                                class="col-auto p-0 m-0 d-flex justify-content-center align-items-center">
                                                <button class="info-button" [matTooltip]="projectStage.name">
                                                    <mat-icon>info_outline</mat-icon>
                                                </button>
                                            </div>
                                            <div class="col-11">
                                                <span class="project-stage-name-title">
                                                    {{projectStageHeader}}
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <mat-divider class="mt-3"></mat-divider>
                                <div class="row mt-2 m-0 p-0">
                                    <div class="col-auto mt-2">
                                        <div style="width: 120px;">
                                            <span class="p-0" style="font-size: 18px; margin-top: 10px!important;">
                                                Завершён:
                                            </span>
                                        </div>
                                    </div>
                                    <div class="col">
                                        <span class="p-0" style="font-size: 18px">
                                            <mat-chip-listbox>
                                                <div class="w-100 d-flex justify-content-start m-0">
                                                    <mat-chip
                                                        [class.mat-chip-main-color-style]="projectStage.isCompleted">
                                                        <span
                                                            [class.mat-chip-main-color-font-style]="projectStage.isCompleted"
                                                            style="font-size: 16px;">Да</span>
                                                    </mat-chip>
                                                    <mat-chip
                                                        [class.mat-chip-main-color-style]="!projectStage.isCompleted">
                                                        <span
                                                            [class.mat-chip-main-color-font-style]="!projectStage.isCompleted"
                                                            style="font-size: 16px;">Нет</span></mat-chip>
                                                </div>
                                            </mat-chip-listbox>
                                        </span>
                                    </div>
                                </div>
                                <div class="row mt-1 m-0 p-0">
                                    <div class="col-auto mt-2">
                                        <div style="width: 120px;">
                                            <span class="p-0" style="font-size: 18px; margin-top: 10px!important;">
                                                Название:
                                            </span>
                                        </div>
                                    </div>
                                    <div class="col">
                                        <span class="p-0" style="font-size: 18px">
                                            <mat-form-field appearance="outline" class="w-100"
                                                style="max-width: 650px;">
                                                <textarea readonly="true" matInput type="text"
                                                    [(ngModel)]="projectStage.name" rows="3" #textAreaName
                                                    maxlength="5000"></textarea>
                                                <mat-hint align="end">
                                                    {{textAreaName.value.length}}/1000
                                                </mat-hint>
                                            </mat-form-field>
                                        </span>
                                    </div>
                                </div>
                                <div class="row m-0 p-0">
                                    <div class="col-auto mt-2">
                                        <div style="width: 120px;">
                                            <span class="p-0" style="font-size: 18px; margin-top: 10px!important;">
                                                Описание:
                                            </span>
                                        </div>
                                    </div>
                                    <div class="col">
                                        <span class="p-0" style="font-size: 18px">
                                            <mat-form-field appearance="outline" class="w-100"
                                                style="max-width: 650px;">
                                                <textarea readonly="true" matInput type="text"
                                                    [(ngModel)]="projectStage.description" rows="5" #textAreaDescription
                                                    maxlength="5000"></textarea>
                                                <mat-hint align="end">
                                                    {{textAreaDescription.value.length}}/5000
                                                </mat-hint>
                                            </mat-form-field>
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <div class="card-container mt-2">
                                <div class="row m-0 p-0">
                                    <div class="col-auto d-flex align-items-center"
                                        style="font-size: 20px; min-height: 48px;">
                                        <span class="p-0">
                                            Отчёты ({{projectStage.stageReports.length}}):
                                        </span>
                                    </div>
                                </div>
                                <mat-divider></mat-divider>
                                <div style="padding-top: 8px;">
                                    <div class="row m-0 p-0" *ngFor="let report of projectStage.stageReports">
                                        <div class="col-auto">
                                            <div class="row m-0 p-0">
                                                <span style="font-size: 18px; line-height: 20px" class="p-0 link-button"
                                                    (click)="OpenStageReportDetails(report)">
                                                    {{report.name}}
                                                </span>
                                            </div>
                                            <div class="row m-0 p-0">
                                                <div class="col-auto m-0 p-0">
                                                    <span class="p-0" style="font-size: 16px; font-style: italic;">
                                                        {{report.stageManager?.employee?.GetLastNameAndInitials()}}
                                                    </span>
                                                </div>
                                                <div class="col-auto">
                                                    <span class="p-0" style="font-size: 16px; font-style: italic;">
                                                        Файлы: ({{report.attachedFiles.length}})
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="card-container mt-2">
                                <div class="row m-0 p-0">
                                    <div class="col-auto d-flex align-items-center"
                                        style="font-size: 20px;min-height: 48px;">
                                        <span class="p-0">
                                            Ответственные лица ({{projectStage.stageManagers.length}}):
                                        </span>
                                    </div>
                                </div>
                                <mat-divider></mat-divider>
                                <div class="row m-0 p-0" *ngFor="let stageManager of projectStage.stageManagers">
                                    <div class="col-auto">
                                        <button mat-icon-button color="primary">
                                            <mat-icon>person</mat-icon>
                                        </button>
                                    </div>
                                    <div class="col-auto m-0 p-0"
                                        style="display: flex; justify-content: center; flex-direction: column;">
                                        <div class="row m-0 p-0">
                                            <span style="font-size: 18px; line-height: 20px" class="p-0">
                                                {{stageManager.employee?.GetLastNameAndInitials()}}
                                            </span>
                                        </div>
                                        <div class="row m-0 p-0">
                                            <span class="p-0" style="font-size: 14px; color: gray;">
                                                {{(stageManager.employee?.lastJob?.positionName ?? "") +
                                                ((!!stageManager.employee?.lastJob?.positionName &&
                                                !!stageManager.employee?.lastJob?.divisionName) ? ' - ' : "") +
                                                (stageManager.employee?.lastJob?.divisionName ?? "")}}
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="card-container mt-2">
                                <div class="row m-0 p-0">
                                    <div class="col-auto d-flex align-items-center"
                                        style="font-size: 20px; min-height: 48px;">
                                        <span class="p-0">
                                            Исполнители ({{projectStage.contractors.length}}):
                                        </span>
                                    </div>
                                </div>
                                <mat-divider></mat-divider>
                                <div class="row m-0 p-0" *ngFor="let contractor of projectStage.contractors">
                                    <div class="col-auto">
                                        <button mat-icon-button color="primary">
                                            <mat-icon>home_work</mat-icon>
                                        </button>
                                    </div>
                                    <div class="col-auto m-0 p-0 d-flex align-items-center">
                                        <span class="p-0" style="font-size: 18px">
                                            {{contractor.division?.name}}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </ng-template>
            </div>
        </div>
    </div>
</app-client-navigation-header>